Magnet Danmaku 组网方案的简要提议
===
1.  主要组网办法  
---
使用kadmelia算法组建DHT网络。  
算法的简要说明见[维基百科](http://en.wikipedia.org/wiki/Kademlia)，
相关论文在[这里](http://pdos.csail.mit.edu/~petar/papers/maymounkov-kademlia-lncs.pdf)。  
**原简介已经删除，原因是细节描述有些问题……具体实现可以去参考各种论文/源码，这里就不描述了……正式文档应该包含这部分的内容**
	
2.  辅助组网办法
---
当DHT网络出现问题（虽然我觉得不太可能），就需要辅助网络帮助。  
使用类似Gnutella的方式组网。  
参考资料[Gnutella协议细节](http://rfc-gnutella.sourceforge.net/src/rfc-0_6-draft.html)，
见3.2节。
该网络需要参考以上协议内容实现一份路由协议。一般情况下该网络不应用于查询（因为有DHT这个高效的查询机制了）；
然而设计一套查询机制是可行的。

3.  从bt网络自举  
---
-   随即选择一个不存在的btih，并通过BitTorrent-DHT网络发布。
md客户端需要按照bt的协议与tracker交互、参与DHT网络，发布并只发布这一个btih。
新加入的客户端，如果没有md的节点列表，可以到bt网络中寻找拥有这个btih的peer，
同时检查发布者的客户端字符串以识别md客户端。
当发现至少一个md客户端后，就可以按照md的组网办法加入md网络。

4.  客户端id  
---
建议每个客户端都生成一对非对称密钥，用于消息签名。
其中，公钥的sha1被用来做客户端的id。
每次连接应当验证对方的公钥是否是伪造。

5.  NAT穿透  
---
现实中，客户端不总是拥有公网IP。为此，已经有多种现存技术来进行NAT穿透。
穿透应首选UPnP，其次用STUN，最后才使用TURN。对于双方Symmetric NAT，应当尽可能地猜测端口。
如果有客户端没有公网IP且NAT不是Full Cone，那么它不能承担以下几个功能：  

-   DHT路由
-   超级节点

如果STUN不是Full cone，也不能承担DHT路由和超级节点的功能。
然而它仍能下载弹幕池，并应当存储访问过的弹幕池，且积极分享。

6.  安全
---
-   客户端公钥应当做Proof of Work，可以使用在公钥后附加一段字符串使sha1值的前m位变为0。
	该做法不改变计算id的行为；即id的计算不包括附加的字符串。
	此举仅是为了防止大量恶意客户端加入网络，影响网络功能。
-   可以考虑以上两种网络都使用两份路由表：一般路由表和安全路由表。其中安全路由表应当只包含可信节点。

7.   补充
---
-   IPv4和IPv6分别组网，再通过双栈的节点做中继（类似TURN，不妨考虑与TURN合并成同一个方法）
-   考虑让不具备路由功能的节点把离其最近的节点作为STUN/TURN代理节点

## 欢迎各种意见、评论、吐槽！我只是觉得进度太慢看不下去了…… ##
Proposal_0003 by Swordfeng at 2015.04.08
